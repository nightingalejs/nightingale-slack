{"version":3,"sources":["../src/index.js"],"names":["markdownFormatter","rawFormatter","post","levels","levelToSlackColor","TRACE","DEBUG","INFO","WARN","ERROR","CRITICAL","FATAL","EMERGENCY","createHandler","slackConfig","record","markdown","raw","body","channel","username","icon_url","iconUrl","icon_emoji","iconEmoji","attachments","fallback","title","message","color","level","text","mrkdwn_in","url","webhookUrl","json","on","err2","console","error","stack","SlackHandler","minLevel","handle"],"mappings":"AAAA;AACA,OAAOA,iBAAP;AACA,OAAOC,YAAP;AACA,SAASC,IAAT,QAAqB,SAArB;AACA,OAAOC,MAAP,MAAmB,oBAAnB;;AAEA,MAAMC,oBAAoB;AACxB,GAACD,OAAOE,KAAR,GAAgB,SADQ;AAExB,GAACF,OAAOG,KAAR,GAAgB,SAFQ;AAGxB,GAACH,OAAOI,IAAR,GAAe,SAHS;AAIxB,GAACJ,OAAOK,IAAR,GAAe,SAJS;AAKxB,GAACL,OAAOM,KAAR,GAAgB,QALQ;AAMxB,GAACN,OAAOO,QAAR,GAAmB,QANK;AAOxB,GAACP,OAAOQ,KAAR,GAAgB,QAPQ;AAQxB,GAACR,OAAOS,SAAR,GAAoB;AARI,CAA1B;;AAWA,MAAMC,gBAAiBC,WAAD,IAAiBC,UAAU;AAC/C,QAAMC,WAAWhB,kBAAkBe,MAAlB,CAAjB;AACA,QAAME,MAAMhB,aAAac,MAAb,CAAZ;;AAEA,QAAMG,OAAO;AACXC,aAASL,YAAYK,OADV;AAEXC,cAAUN,YAAYM,QAFX;AAGXC,cAAUP,YAAYQ,OAHX;AAIXC,gBAAYT,YAAYU,SAJb;AAKXC,iBAAa,CACX;AACEC,gBAAUT,GADZ;AAEEU,aAAOZ,OAAOa,OAFhB;AAGEC,aAAOzB,kBAAkBW,OAAOe,KAAzB,CAHT;AAIEC,YAAMf,QAJR;AAKEgB;AALF,KADW;AALF,GAAb;;AAgBA9B,OAAK,EAAE+B,KAAKnB,YAAYoB,UAAnB,EAA+BhB,IAA/B,EAAqCiB,MAAM,IAA3C,EAAL,EACGC,EADH,CACM,OADN,EACgBC,IAAD,IAAUC,QAAQC,KAAR,CAAcF,KAAKG,KAAnB,CADzB;AAED,CAtBD;;AAgCA,eAAe,SAASC,YAAT,CAAsB3B,WAAtB,EAAoD4B,QAApD,EAAsE;AACnF,OAAKA,QAAL,GAAgBA,QAAhB;AACA,OAAKC,MAAL,GAAc9B,cAAcC,WAAd,CAAd;AACD","file":"index.js","sourcesContent":["/* eslint camelcase: \"off\" */\nimport markdownFormatter from 'nightingale-markdown-formatter/src';\nimport rawFormatter from 'nightingale-raw-formatter/src';\nimport { post } from 'request';\nimport levels from 'nightingale-levels';\n\nconst levelToSlackColor = {\n  [levels.TRACE]: '#808080',\n  [levels.DEBUG]: '#808080',\n  [levels.INFO]: '#808080',\n  [levels.WARN]: 'warning',\n  [levels.ERROR]: 'danger',\n  [levels.CRITICAL]: 'danger',\n  [levels.FATAL]: 'danger',\n  [levels.EMERGENCY]: 'danger',\n};\n\nconst createHandler = (slackConfig) => record => {\n  const markdown = markdownFormatter(record);\n  const raw = rawFormatter(record);\n\n  const body = {\n    channel: slackConfig.channel,\n    username: slackConfig.username,\n    icon_url: slackConfig.iconUrl,\n    icon_emoji: slackConfig.iconEmoji,\n    attachments: [\n      {\n        fallback: raw,\n        title: record.message,\n        color: levelToSlackColor[record.level],\n        text: markdown,\n        mrkdwn_in: ['text'],\n      },\n    ],\n  };\n\n  post({ url: slackConfig.webhookUrl, body, json: true })\n    .on('error', (err2) => console.error(err2.stack));\n};\n\ntype SlackConfigType = {\n  webhookUrl: string,\n  channel: ?string,\n  username: ?string,\n  iconUrl: ?string,\n  iconEmoji: ?string,\n};\n\nexport default function SlackHandler(slackConfig: SlackConfigType, minLevel: number) {\n  this.minLevel = minLevel;\n  this.handle = createHandler(slackConfig);\n}\n"]}